{"creationTimeStamp":"2026-01-10T16:19:13.406808Z","createdBy":"gerdaw","modifiedTimeStamp":"2026-01-10T17:15:20.104773Z","modifiedBy":"gerdaw","id":"dc5a4cef-307f-48cd-944a-2bd06c937dc4","name":"Get SAS Job Definition Information.step","displayName":"Get SAS Job Definition Information.step","localDisplayName":"Get SAS Job Definition Information.step","links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","uri":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","uri":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","uri":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","uri":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4/copy","uri":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","uri":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","uri":"/dataFlows/steps/dc5a4cef-307f-48cd-944a-2bd06c937dc4","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":1,"version":2,"type":"code","flowMetadata":{"outputPorts":[{"name":"_ijd_outtable_1","displayName":"_ijd_outtable_1","localDisplayName":"_ijd_outtable_1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"},{"name":"_ijd_outtable_2","displayName":"_ijd_outtable_2","localDisplayName":"_ijd_outtable_2","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"},{"name":"_ijd_outtable_3","displayName":"_ijd_outtable_3","localDisplayName":"_ijd_outtable_3","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageOptions\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Options\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Retrieves information about all SAS Job Definitions in the current SAS Viya environment.\\n\\nThe result is stored in three output tables:\\n1. Contains the key information about each individual SAS Job Definition. There is one row per SAS Job Definition.\\n2. Contains information about the parameters of the SAS Job Definition. There is one row per parameter in this table. So one SAS Job Definition can have 0 to n rows associated with it.\\n3. Contains information about the properties of the SAS Job Definition. There is one row per property in this table. So one SAS Job Definition can have 0 to n rows associated with it.\\n\\nThe column id is shared across all three tables, it is the primary key of the first table and the foreign key of the other two tables.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_ijd_outtable_1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Key information about SAS Job Definitions:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"work.sas_job_definition_index\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_ijd_outtable_2\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Parameter information about SAS Job Definitions:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"work.sas_job_definition_params\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_ijd_outtable_3\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Property information about SAS Job Definitions:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"work.sas_job_definition_props\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section1\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Result tables in CAS\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"If the connected output tables are stored in a CAS library, then you can choose to promote and/or save the result to the same CAS library.\\n\\nIf one of the tables is not stored in CAS, then it will be skipped by this process.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_ijd_promote\",\n\t\t\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\t\t\"label\": \"Promote the resut tables\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_ijd_save\",\n\t\t\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\t\t\"label\": \"Save the result tables\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Get SAS Job Definition Information step\\n==========\\n\\nThe custom steps looks up all SAS Job Definitions in the current SAS Viya environment via the /jobDefinitions/definitions API endpoint and then creates three output tables that contain all of the information collected.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Pre-requisites:  Tested on Viya version Stable 2025.12\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* https://developer.sas.com/rest-apis/jobDefinitions/getJobDefinitions\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version: 1.0 (10JAN2026)\\n      - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"_ijd_outtable_1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_ijd_outtable_2\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_ijd_outtable_3\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_ijd_promote\": false,\n\t\t\"_ijd_save\": false\n\t}\n}","localUi":"{\"pages\":[{\"children\":[{\"id\":\"text1\",\"text\":\"Retrieves information about all SAS Job Definitions in the current SAS Viya environment.\\n\\nThe result is stored in three output tables:\\n1. Contains the key information about each individual SAS Job Definition. There is one row per SAS Job Definition.\\n2. Contains information about the parameters of the SAS Job Definition. There is one row per parameter in this table. So one SAS Job Definition can have 0 to n rows associated with it.\\n3. Contains information about the properties of the SAS Job Definition. There is one row per property in this table. So one SAS Job Definition can have 0 to n rows associated with it.\\n\\nThe column id is shared across all three tables, it is the primary key of the first table and the foreign key of the other two tables.\",\"type\":\"text\",\"visible\":\"\"},{\"id\":\"_ijd_outtable_1\",\"label\":\"Key information about SAS Job Definitions:\",\"placeholder\":\"work.sas_job_definition_index\",\"required\":true,\"type\":\"outputtable\",\"visible\":\"\"},{\"id\":\"_ijd_outtable_2\",\"label\":\"Parameter information about SAS Job Definitions:\",\"placeholder\":\"work.sas_job_definition_params\",\"required\":true,\"type\":\"outputtable\",\"visible\":\"\"},{\"id\":\"_ijd_outtable_3\",\"label\":\"Property information about SAS Job Definitions:\",\"placeholder\":\"work.sas_job_definition_props\",\"required\":true,\"type\":\"outputtable\",\"visible\":\"\"},{\"children\":[{\"id\":\"text2\",\"text\":\"If the connected output tables are stored in a CAS library, then you can choose to promote and/or save the result to the same CAS library.\\n\\nIf one of the tables is not stored in CAS, then it will be skipped by this process.\",\"type\":\"text\",\"visible\":\"\"},{\"id\":\"_ijd_promote\",\"label\":\"Promote the resut tables\",\"type\":\"checkbox\",\"visible\":\"\"},{\"id\":\"_ijd_save\",\"label\":\"Save the result tables\",\"type\":\"checkbox\",\"visible\":\"\"}],\"id\":\"section1\",\"label\":\"Result tables in CAS\",\"open\":true,\"type\":\"section\",\"visible\":\"\"}],\"id\":\"pageOptions\",\"label\":\"Options\",\"type\":\"page\"},{\"children\":[{\"id\":\"textAbout\",\"text\":\"Get SAS Job Definition Information step\\n==========\\n\\nThe custom steps looks up all SAS Job Definitions in the current SAS Viya environment via the /jobDefinitions/definitions API endpoint and then creates three output tables that contain all of the information collected.\",\"type\":\"text\",\"visible\":\"\"},{\"children\":[{\"id\":\"textPrereqs\",\"text\":\"Pre-requisites:  Tested on Viya version Stable 2025.12\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionPrereqs\",\"label\":\"Pre-requisites\",\"open\":false,\"type\":\"section\",\"visible\":\"\"},{\"children\":[{\"id\":\"textDocumentation\",\"text\":\"* https://developer.sas.com/rest-apis/jobDefinitions/getJobDefinitions\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionDocumentation\",\"label\":\"Documentation\",\"open\":false,\"type\":\"section\",\"visible\":\"\"},{\"children\":[{\"id\":\"textChangelog\",\"text\":\"* Version: 1.0 (10JAN2026)\\n      - Initial version\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionChangelog\",\"label\":\"Changelog\",\"open\":true,\"type\":\"section\",\"visible\":\"\"}],\"id\":\"pageAbout\",\"label\":\"About\",\"type\":\"page\"}],\"showPageContentOnly\":true,\"syntaxversion\":\"1.3.0\",\"values\":{\"_ijd_outtable_1\":{\"library\":\"\",\"table\":\"\"},\"_ijd_outtable_2\":{\"library\":\"\",\"table\":\"\"},\"_ijd_outtable_3\":{\"library\":\"\",\"table\":\"\"},\"_ijd_promote\":false,\"_ijd_save\":false}}","templates":{"SAS":"* ijd stand for Indexing SAS Job Definitions;\n* Macro to get all job definitions in Viya environment;\n%macro _ijd_get_job_definitions(_ijd_start=0, _ijd_limit=250);\n    %local _ijd_viyaHost;\n\n    %let _ijd_viyaHost = %sysFunc(getOption(servicesBaseURL));\n\n    filename _ijd_out temp;\n\n    * https://developer.sas.com/rest-apis/jobDefinitions/getJobDefinitions;\n    proc http\n        method = 'Get'\n        url = \"&_ijd_viyaHost./jobDefinitions/definitions?start=&_ijd_start.%nrstr(&)limit=&_ijd_limit.\"\n        oauth_bearer = sas_services\n        out = _ijd_out;\n        headers 'Accept' = 'application/json';\n    run;\n\n    libname _ijd_out json;\n\n    * Get the number of observations where one obs = one job definition;\n    proc sql noprint;\n        select count(*) into :_ijd_ds_nobs trimmed from _ijd_out.items;\n    quit;\n\n    * Get the number of columns;\n    proc sql noprint;\n        select nvar into :_ijd_nvar trimmed from dictionary.tables where\n            libname='_IJD_OUT' and memname='ITEMS';\n    quit;\n\n    * Handle the first iteration and subsequent requests;\n    %if &_ijd_start. eq 0 %then %do;\n        data work._ijd_job_definition_index_temp(rename=(cTS=ccreationTimeStamp mTS=modifiedTimeStamp));\n            length id $36. name $1024. cTS mTS 8. createdBy modifiedBy $1024. type $64. description $32000. has_code code_line_count 8.;\n            format cTS mTS datetime22.3;\n\n            set _ijd_out.items(drop=ordinal_root version);\n\n            cTS = input(creationTimeStamp, e8601dz26.);\n            mTS = input(modifiedTimeStamp, e8601dz26.);\n\n            if length(code) > 1 then do;\n                has_code = 1;\n                code_line_count = countw(code, '\\n');\n            end;\n            else has_code = 0;\n\n            drop creationTimeStamp modifiedTimeStamp code;\n        run;\n\n        data work._ijd_job_definition_params_temp;\n            length parameter_name $64. parameter_type $64. parameter_label $32000. is_required 8. default_value $32000.;\n            set _ijd_out.items_parameters(drop=ordinal_parameters version);\n\n            parameter_name = name;\n            parameter_type = type;\n            parameter_label = label;\n            is_required = required;\n            default_value = defaultValue;\n\n            drop name type label required defaultValue;\n        run;\n\n        data work._ijd_job_definition_props_temp;\n            length property_name $64. property_value $32000. has_html_form has_xml_prompt has_json_prompt 8.;\n            set _ijd_out.items_properties(drop=ordinal_properties);\n\n            property_name = name;\n            if name eq 'prompts_v2' then do;\n                has_json_prompt = 1;\n                property_value = 'Code not copied!';\n            end;\n            else if name eq 'prompts' then do;\n                has_xml_prompt = 1;\n                property_value = 'Code not copied!';\n            end;\n            else if name eq 'form' then do;\n                has_html_form = 1;\n                property_value = 'Code not copied!';\n            end;\n            else do;\n                property_value = value;\n            end;\n\n            drop name value;\n        run;\n    %end;\n    %else %do;\n        %if &_ijd_nvar. gt 2 %then %do;\n            data work._ijd_job_definition_index_tmp(rename=(cTS=ccreationTimeStamp mTS=modifiedTimeStamp));\n                length id $36. name $1024. cTS mTS 8. createdBy modifiedBy $1024. type $64. description $32000. has_code code_line_count 8.;\n                format cTS mTS datetime22.3;\n\n                set _ijd_out.items(drop=ordinal_root version);\n\n                ordinal_items = ordinal_items + (&_ijd_start. * &_ijd_limit.);\n\n                cTS = input(creationTimeStamp, e8601dz26.);\n                mTS = input(modifiedTimeStamp, e8601dz26.);\n\n                if length(code) > 1 then do;\n                    has_code = 1;\n                    code_line_count = countw(code, '\\n');\n                end;\n                else has_code = 0;\n\n                drop creationTimeStamp modifiedTimeStamp code;\n            run;\n\n            data work._ijd_job_definition_params_tmp;\n                length parameter_name $64. parameter_type $64. parameter_label $32000. is_required 8. default_value $32000.;\n                set _ijd_out.items_parameters(drop=ordinal_parameters version);\n\n                ordinal_items = ordinal_items + (&_ijd_start. * &_ijd_limit.);\n                parameter_name = name;\n                parameter_type = type;\n                parameter_label = label;\n                is_required = required;\n                default_value = defaultValue;\n\n                drop name type label required defaultValue;\n            run;\n\n            data work._ijd_job_definition_props_tmp;\n                length property_name $64. property_value $32000. has_html_form has_xml_prompt has_json_prompt 8.;\n                set _ijd_out.items_properties(drop=ordinal_properties);\n\n                ordinal_items = ordinal_items + (&_ijd_start. * &_ijd_limit.);\n                property_name = name;\n                if name eq 'prompts_v2' then do;\n                    has_json_prompt = 1;\n                    property_value = 'Code not copied!';\n                end;\n                else if name eq 'prompts' then do;\n                    has_xml_prompt = 1;\n                    property_value = 'Code not copied!';\n                end;\n                else if name eq 'form' then do;\n                    has_html_form = 1;\n                    property_value = 'Code not copied!';\n                end;\n                else do;\n                    property_value = value;\n                end;\n\n                drop name value;\n            run;\n\n            proc append base=work._ijd_job_definition_index_temp\n                data=work._ijd_job_definition_index_tmp;\n            quit;\n\n            proc append base=work._ijd_job_definition_params_temp\n                data=work._ijd_job_definition_params_tmp;\n            quit;\n\n            proc append base=work._ijd_job_definition_props_temp\n                data=work._ijd_job_definition_props_tmp;\n            quit;\n        %end;\n    %end;\n\n    libname _ijd_out clear;\n    filename _ijd_out clear;\n\n    proc dataSets lib=work noList;\n        delete _ijd_job_definition_index_tmp _ijd_job_definition_params_tmp _ijd_job_definition_props_tmp;\n    quit;\n\n    * Check if another iteration is needed;\n    %if &_ijd_ds_nobs eq &_ijd_limit and &_ijd_nvar. gt 2 %then %do;\n        %put NOTE: Getting more job definitions...;\n        %let _ijd_new_start=%eval(&_ijd_start. + &_ijd_limit.);\n        %_ijd_get_job_definitions(_ijd_start=&_ijd_new_start., _ijd_limit=&_ijd_limit.);\n    %end;\n\n%mend _ijd_get_job_definitions;\n\n%_ijd_get_job_definitions();\n\n* Drop the tables in CAS, if they exist and the user wants to promote;\n%if &_ijd_outtable_1_engine. eq CAS && &_ijd_promote. eq 1 %then %do;\n    %let _ijd_outtable_1_lib = %sysfunc(getlcaslib(&_ijd_outtable_1_lib));\n\n    proc casUtil inCASLib = \"&_ijd_outtable_1_lib.\";\n        dropTable casData = \"&_ijd_outtable_1_name.\" quiet;\n    quit;\n%end;\n%if &_ijd_outtable_2_engine. eq CAS && &_ijd_promote. eq 1 %then %do;\n    %let _ijd_outtable_2_lib = %sysfunc(getlcaslib(&_ijd_outtable_2_lib));\n\n    proc casUtil inCASLib = \"&_ijd_outtable_2_lib.\";\n        dropTable casData = \"&_ijd_outtable_2_name.\" quiet;\n    quit;\n%end;\n%if &_ijd_outtable_3_engine. eq CAS && &_ijd_promote. eq 1 %then %do;\n    %let _ijd_outtable_3_lib = %sysfunc(getlcaslib(&_ijd_outtable_3_lib));\n\n    proc casUtil inCASLib = \"&_ijd_outtable_3_lib.\";\n        dropTable casData = \"&_ijd_outtable_3_name.\" quiet;\n    quit;\n%end;\n\n* Combine parameter and property information with job definition id;\nproc sql;\n    create table &_ijd_outtable_2. as\n        select b.id\n            , a.parameter_name\n            , a.parameter_type\n            , a.parameter_label\n            , a.is_required\n            , a.default_value\n            from work._ijd_job_definition_params_temp as a\n                left join work._ijd_job_definition_index_temp as b\n                    on a.ordinal_items = b.ordinal_items;\n    \n    create table work._ijd_parameter_count as\n        select id, count(*) as parameter_count\n            from &_ijd_outtable_2.\n                group by id;\n\n    create table &_ijd_outtable_3. as\n        select b.id\n            , a.property_name\n            , a.property_value\n            , a.has_json_prompt\n            , a.has_xml_prompt\n            , a.has_html_form\n            from work._ijd_job_definition_props_temp as a\n                left join work._ijd_job_definition_index_temp as b\n                    on a.ordinal_items = b.ordinal_items;\nquit;\n\n* Sort by id for py group processing;\nproc sort data=&_ijd_outtable_3. out=work._ijd_job_prop_sorted;\n    by id;\nrun;\n\n* Aggregate information about prompts and forms per job definition;\ndata work._ijd_job_prop_info;\n    set work._ijd_job_prop_sorted;\n    by id;\n\n    retain json_prompt xml_prompt html_form;\n\n    if first.id then do;\n        json_prompt = 0;\n        xml_prompt = 0;\n        html_form = 0;\n    end;\n\n    if has_json_prompt = 1 then json_prompt = 1;\n    if has_xml_prompt = 1 then xml_prompt = 1;\n    if has_html_form = 1 then html_form = 1;\n\n    if last.id then do;\n        output;\n        drop property_name property_value has_json_prompt has_xml_prompt has_html_form;\nend;\n\n* Create final job definition index with parameter counts and prompt/form info;\nproc sql;\n    create table &_ijd_outtable_1. as\n        select a.*\n            , coalesce(b.parameter_count, 0) as parameter_count\n            , coalesce(c.json_prompt, 0) as has_json_prompt\n            , coalesce(c.xml_prompt, 0) as has_xml_prompt\n            , coalesce(c.html_form, 0) as has_html_form\n            from work._ijd_job_definition_index_temp(drop=ordinal_items) as a\n                left join work._ijd_parameter_count as b\n                    on a.id = b.id\n                left join work._ijd_job_prop_info as c\n                    on a.id = c.id;\nquit;\n\n* Promote and save to CAS if needed;\n%macro _ijd_promote_and_save_to_cas();\n    %if &_ijd_outtable_1_engine. eq CAS %then %do;\n        proc casUtil inCASLib = \"&_ijd_outtable_1_lib.\" outCASLib = \"&_ijd_outtable_1_lib.\";\n            %if &_ijd_promote. eq 1 %then %do;\n                promote casData = \"&_ijd_outtable_1_name.\";\n            %end;\n            %if &_ijd_save. eq 1 %then %do;\n                save casData = \"&_ijd_outtable_1_name.\" casOut = \"&_ijd_outtable_1_name.\" replace;\n            %end;\n        quit;\n    %end;\n    %if &_ijd_outtable_2_engine. eq CAS %then %do;\n        proc casUtil inCASLib = \"&_ijd_outtable_2_lib.\" outCASLib = \"&_ijd_outtable_2_lib.\";\n            %if &_ijd_promote. eq 1 %then %do;\n                promote casData = \"&_ijd_outtable_2_name.\";\n            %end;\n            %if &_ijd_save. eq 1 %then %do;\n                save casData = \"&_ijd_outtable_2_name.\" casOut = \"&_ijd_outtable_2_name.\" replace;\n            %end;\n        quit;\n    %end;\n    %if &_ijd_outtable_3_engine. eq CAS %then %do;\n        proc casUtil inCASLib = \"&_ijd_outtable_3_lib.\" outCASLib = \"&_ijd_outtable_3_lib.\";\n            %if &_ijd_promote. eq 1 %then %do;\n                promote casData = \"&_ijd_outtable_3_name.\";\n            %end;\n            %if &_ijd_save. eq 1 %then %do;\n                save casData = \"&_ijd_outtable_3_name.\" casOut = \"&_ijd_outtable_3_name.\" replace;\n            %end;\n        quit;\n    %end;\n%mend _ijd_promote_and_save_to_cas;\n\n%_ijd_promote_and_save_to_cas();\n\n* Clean up;\n%sysmacdelete _ijd_get_job_definitions;\n%sysmacdelete _ijd_promote_and_save_to_cas;\nproc dataSets lib=work noList;\n    delete _ijd_job_definition_params_temp _ijd_job_definition_props_temp _ijd_parameter_count _ijd_job_prop_info _ijd_job_prop_sorted _ijd_job_definition_index_temp;\nquit;"}}
