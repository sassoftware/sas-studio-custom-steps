{"creationTimeStamp":"2025-11-20T07:36:43.817186Z","createdBy":"Remco.Gooijer@sas.com","modifiedTimeStamp":"2026-01-12T07:30:33.404539Z","modifiedBy":"Remco.Gooijer@sas.com","id":"f85b4060-5b80-46fb-a9ef-d02ebbd41463","name":"Glossary - Get Term Types.step","displayName":"Glossary - Get Term Types.step","localDisplayName":"Glossary - Get Term Types.step","links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","uri":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","uri":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","uri":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","uri":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463/copy","uri":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","uri":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","uri":"/dataFlows/steps/f85b4060-5b80-46fb-a9ef-d02ebbd41463","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":1,"version":2,"type":"code","flowMetadata":{"outputPorts":[{"name":"_output1","displayName":"_output1","localDisplayName":"_output1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"},{"name":"_output2","displayName":"_output2","localDisplayName":"_output2","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"},{"name":"_output3","displayName":"_output3","localDisplayName":"_output3","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Options\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_sortBy\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Sort by column:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"id\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"name\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"label\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"description\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"createdBy\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"creationTimeStamp\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"modifiedBy\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"modifiedTimeStamp\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_limit\",\n\t\t\t\t\t\"type\": \"numberfield\",\n\t\t\t\t\t\"label\": \"Limit the numbers of returned values to:\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"max\": null,\n\t\t\t\t\t\"min\": 10,\n\t\t\t\t\t\"excludemin\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_output1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Term types:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_output2\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Term type attributes:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_output3\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Term type attribute values:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"page2\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\\nGlossary - Get Term Types\\n======================\\n\\nThis custom step extracts all term types, the term type attributes and, if available, the items you can choose from, for a given term type attribute.\\n\\nIt outputs three tables:\\n1. With the term types\\n2. With the term type attributes\\n3. The values you can choose from, for a given term type attribute.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section1\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version 1 (12JAN2026)\\n- Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"_sortBy\": {\n\t\t\t\"value\": \"name\"\n\t\t},\n\t\t\"_limit\": 50,\n\t\t\"_output1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_output2\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_output3\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t},\n\t\"promptHierarchies\": []\n}","localUi":"{\"pages\":[{\"children\":[{\"id\":\"_sortBy\",\"items\":[{\"value\":\"id\"},{\"value\":\"name\"},{\"value\":\"label\"},{\"value\":\"description\"},{\"value\":\"createdBy\"},{\"value\":\"creationTimeStamp\"},{\"value\":\"modifiedBy\"},{\"value\":\"modifiedTimeStamp\"}],\"label\":\"Sort by column:\",\"placeholder\":\"\",\"required\":true,\"type\":\"dropdown\",\"visible\":\"\"},{\"excludemin\":false,\"id\":\"_limit\",\"label\":\"Limit the numbers of returned values to:\",\"max\":null,\"min\":10,\"placeholder\":\"\",\"required\":true,\"type\":\"numberfield\",\"visible\":\"\"},{\"id\":\"_output1\",\"label\":\"Term types:\",\"placeholder\":\"\",\"required\":true,\"type\":\"outputtable\",\"visible\":\"\"},{\"id\":\"_output2\",\"label\":\"Term type attributes:\",\"placeholder\":\"\",\"required\":true,\"type\":\"outputtable\",\"visible\":\"\"},{\"id\":\"_output3\",\"label\":\"Term type attribute values:\",\"placeholder\":\"\",\"required\":true,\"type\":\"outputtable\",\"visible\":\"\"}],\"id\":\"page1\",\"label\":\"Options\",\"type\":\"page\"},{\"children\":[{\"id\":\"text1\",\"text\":\"\\nGlossary - Get Term Types\\n======================\\n\\nThis custom step extracts all term types, the term type attributes and, if available, the items you can choose from, for a given term type attribute.\\n\\nIt outputs three tables:\\n1. With the term types\\n2. With the term type attributes\\n3. The values you can choose from, for a given term type attribute.\",\"type\":\"text\",\"visible\":\"\"},{\"children\":[{\"id\":\"text2\",\"text\":\"* Version 1 (12JAN2026)\\n- Initial version\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"section1\",\"label\":\"Changelog\",\"open\":true,\"type\":\"section\",\"visible\":\"\"}],\"id\":\"page2\",\"label\":\"About\",\"type\":\"page\"}],\"promptHierarchies\":[],\"showPageContentOnly\":true,\"syntaxversion\":\"1.3.0\",\"values\":{\"_limit\":50,\"_output1\":{\"library\":\"\",\"table\":\"\"},\"_output2\":{\"library\":\"\",\"table\":\"\"},\"_output3\":{\"library\":\"\",\"table\":\"\"},\"_sortBy\":{\"value\":\"name\"}}}","templates":{"SAS":"/*\r\n    SAS Documentation: https://developer.sas.com/rest-apis/glossary\r\n\r\n    Initialize the following two macro variables.\r\n*/\r\ndata _null_; \r\n\tcall symputx('viyaHost', kreverse(ksubstr(ksubstr(kreverse(\"&_BASEURL.\"), 2), kfind(ksubstr(kreverse(\"&_BASEURL.\"), 2), '/') + 1)));\r\nrun;\r\n%let inError=0;\r\n\r\n%macro getTermTypes;\r\n    /*\r\n        The first of three steps. Get all, with a maximum of '_limit', term types from the Viya system.\r\n    */\r\n    filename tTypes temp;\r\n    proc http\r\n        method ='get'\r\n        url = \"&viyaHost./glossary/termTypes?limit=&_limit%nrstr(&)sortBy=&_sortBy\"\r\n        oauth_bearer = sas_services\r\n        out = tTypes;\r\n        headers\r\n            \"Accept\"=\"application/json, application/vnd.sas.collection+json, application/vnd.sas.error+json\"\r\n            \"Accept-Item\"=\"application/vnd.sas.glossary.term.type.summary+json\";\r\n    run;\r\n\r\n    %if %sysfunc(fexist(tTypes)) %then %do;\r\n        libname tTypes json;\r\n        proc sql;\r\n            create table &_output1 as\r\n            select\r\n                id as termTypeId length=36 format=$36.,\r\n                version format=8.,\r\n                name length=512 format=$512.,\r\n                label length=512 format=$512.,\r\n                description length=1024 format=$1024.,\r\n                usageCount format=8.,\r\n                attributeCount format=8.,\r\n                input(creationTimeStamp, E8601DZ.) as creationTimeStamp format=datetime22.3,\r\n                input(modifiedTimeStamp, E8601DZ.) as modifiedTimeStamp format=datetime22.3,\r\n                createdBy length=64 format=$64.,\r\n                modifiedBy length=64 format=$64.\r\n            from\r\n                tTypes.items;\r\n        quit;\r\n    %end;\r\n    %else %do;\r\n        %put ERROR: No response file received for macro 'getTermTypes'. Please review the log for more details.;\r\n        /*\r\n            The following macro variable will prevent the custom step from running further and generating more errors/warnings.\r\n        */\r\n        %let inError = 1;\r\n    %end;\r\n%mend;\r\n%getTermTypes;\r\n\r\n/*\r\n    The following table is an intermediate table for _output2.\r\n    The label and name column need to be renamed. \r\n*/\r\ndata termTypeAttributes;\r\n    attrib termTypeId length=$36.;\r\n    attrib name length=$36.;\r\n    attrib label length=$36.;\r\n    attrib description length=$1024.;\r\n    attrib type length=$32.;\r\n    attrib required length=8.;\r\n    attrib defaultValue length=$32.;\r\n    stop;\r\nrun;\r\n\r\n/*\r\n    The template for the table that contains the values an end-user can choose.\r\n\r\n    Note that following table layout is not the final one.\r\n*/\r\ndata &_output3;\r\n    attrib attributeId length=$36.;\r\n    attrib items1 length=$32.;\r\n    attrib items2 length=$32.;\r\n    attrib items3 length=$32.;\r\n    attrib items4 length=$32.;\r\n    attrib items5 length=$32.;\r\n    attrib items6 length=$32.;\r\n    attrib items7 length=$32.;\r\n    attrib items8 length=$32.;\r\n    attrib items9 length=$32.;\r\n    attrib items10 length=$32.;\r\n    attrib items11 length=$32.;\r\n    attrib items12 length=$32.;\r\n    stop;\r\nrun;\r\n\r\n/*\r\n    Not all columns are available for each term type.\r\n    The following macro gives me the columns that ARE available.\r\n*/\r\n%macro existingColumns\r\n(\r\n    tableName=\r\n);    \r\n    proc sql noprint;\r\n        select\r\n            name into :existing_columns separated by ', '\r\n        from\r\n            dictionary.columns\r\n        where\r\n            upcase(libname) = 'TTATTRIB' and\r\n            upcase(memname) = \"&tableName\" and\r\n            upcase(name) not like '%ORDINAL_%';\r\n    quit;\r\n%mend;\r\n\r\n%macro getTermTypeById\r\n(\r\n    termTypeId=\r\n);\r\n\r\n    filename ttAttrib temp;\r\n    proc http\r\n        method ='get'\r\n        url = \"&viyaHost./glossary/termTypes/&termTypeId\"\r\n        oauth_bearer = sas_services\r\n        out = ttAttrib;\r\n        headers\r\n            \"Accept\"=\"application/json, application/vnd.sas.collection+json, application/vnd.sas.error+json\"\r\n            \"Accept-Item\"=\"application/vnd.sas.glossary.term.type.summary+json\";\r\n    run;\r\n    \r\n    %if %sysfunc(fexist(ttAttrib)) %then %do;\r\n        libname ttAttrib json;\r\n\r\n        /*\r\n            Get the available columns for this instance of the response file.\r\n        */\r\n        %let existing_columns =;\r\n        %existingColumns(tableName=ATTRIBUTES);\r\n\r\n        %if &existing_columns ne %then %do;\r\n            proc sql noprint;\r\n                insert into termTypeAttributes\r\n                (\r\n                    termTypeId,\r\n                    &existing_columns\r\n                )\r\n                select\r\n                    \"&termTypeId\",\r\n                    &existing_columns\r\n                from\r\n                    ttAttrib.attributes;\r\n            quit;\r\n        %end;\r\n\r\n        /*\r\n            Make the term type attribut items/values available only in case the\r\n            corresponding table exists.\r\n        */\r\n        %if %sysfunc(exist(TTATTRIB.ATTRIBUTES_ITEMS)) %then %do;\r\n            %let existing_columns =;\r\n            %existingColumns(tableName=ATTRIBUTES_ITEMS);\r\n            proc sql;\r\n                insert into &_output3\r\n                (\r\n                    attributeId,\r\n                    &existing_columns\r\n                )\r\n                select\r\n                    A.name as attributeId length=36 format=$36.,\r\n                    &existing_columns\r\n                from\r\n                    TTATTRIB.ATTRIBUTES A inner join \r\n                    TTATTRIB.ATTRIBUTES_ITEMS AI on A.ordinal_attributes = AI.ordinal_attributes;\r\n            quit;\r\n        %end;\r\n    %end;\r\n    %else %do;\r\n        %put ERROR: No response file received for macro 'getTermTypeById'. Please review the log for more details.;\r\n        %let inError = 1;\r\n    %end;\r\n%mend;\r\n\r\n%macro getTermTypeAttributes;\r\n    /*\r\n        Load each termTypeId into memory\r\n    */\r\n    %let nbr_ids=0;\r\n    data _null_;\r\n        set \r\n            &_output1(keep=termTypeId) end=last;\r\n        call symputx('termTypeId'||kstrip(put(_N_, 8.)), strip(termTypeId));\r\n        if last then call symputx('nbr_ids', _n_);\r\n    run;\r\n\r\n    /*\r\n        And run for each termTypeId the specified macro.\r\n    */\r\n    %do index = 1 %to &nbr_ids;\r\n        %put NOTE: Processing termTypeId (&index of &nbr_ids): &&termTypeId&index;\r\n        %getTermTypeById\r\n            (\r\n                termTypeId = &&termTypeId&index\r\n            );\r\n    %end;\r\n\r\n    /*\r\n        Now normalize and clean the _output3 table.\r\n\r\n        1. Sort the table\r\n    */\r\n    proc sort data=&_output3; \r\n        by \r\n            attributeId; \r\n    run;\r\n\r\n    /*\r\n        2. Transpose the table\r\n    */\r\n    proc transpose \r\n        data=\r\n            &_output3 \r\n        out=\r\n            &_output3\r\n                (\r\n                    drop=_name_ \r\n                    rename=(col1=value)\r\n                );\r\n        by \r\n            attributeId;\r\n        var \r\n            items1 \r\n            items2 \r\n            items3\r\n            items4\r\n            items5\r\n            items6\r\n            items7\r\n            items8\r\n            items9\r\n            items10\r\n            items11\r\n            items12;\r\n    run;\r\n\r\n    /*\r\n        3. Remove the empty values from the table.\r\n    */\r\n    data &_output3;\r\n        set\r\n            &_output3\r\n                (\r\n                    where=(value ne '')\r\n                );\r\n    run;\r\n%mend;\r\n\r\n/*\r\n    Only start the gathering of the term type attributes in case \r\n    we have term types.\r\n*/\r\n%if &inError eq 0 %then %do;\r\n    %getTermTypeAttributes;\r\n%end;\r\n\r\n/*\r\n    Create the second output table and rename some of the columns.\r\n*/\r\ndata &_output2;\r\n    set\r\n        termTypeAttributes\r\n            (\r\n                rename=\r\n                    (\r\n                        name=attributeId \r\n                        label=name\r\n                    )\r\n            );\r\nrun;\r\n\r\n/*\r\n    Remove all macro variables from memory.\r\n*/\r\n%symdel inError /NOWARN;\r\n%symdel nbr_ids /NOWARN;\r\n%symdel existing_columns /NOWARN;\r\n%symdel viyaHost /NOWARN;\r\n\r\n/*\r\n    Remove all macros from memory.\r\n*/\r\n%SYSMACDELETE getTermTypeAttributes / NOWARN;\r\n%SYSMACDELETE getTermTypeById / NOWARN;\r\n%SYSMACDELETE existingColumns / NOWARN;\r\n%SYSMACDELETE getTermTypes / NOWARN;"}}
