{"creationTimeStamp":"2024-09-24T15:17:17.842Z","modifiedTimeStamp":"2024-10-03T13:58:34.641Z","createdBy":"sasdemo","modifiedBy":"sasdemo","name":"Execute SDA Report.step","displayName":"Execute SDA Report.step","localDisplayName":"Execute SDA Report.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","uri":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","uri":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","uri":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","uri":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee/copy","uri":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","uri":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","uri":"/dataFlows/steps/f26c3a3a-8370-4e76-b5fe-fa59696759ee","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Page 1\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"Header\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"SAS Studio Custom Step for executing the SAS Document Analysis report creation process.\\nAt a minimum, users must specify the report type to be output, the file format of the report, and the SAS Launcher Context ID to execute against.\\n\\nFor more details, please reference the official documentation.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"COMMAND\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Report Type\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"create_batch_summary_report.py\",\n\t\t\t\t\t\t\t\"label\": \"Batch Summary\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"create_batch_transactions_report.py\",\n\t\t\t\t\t\t\t\"label\": \"Batch Transactions\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"create_file_summary_report.py\",\n\t\t\t\t\t\t\t\"label\": \"File Summary\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"create_file_transactions_report.py\",\n\t\t\t\t\t\t\t\"label\": \"File Transactions\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"REPORT_OUTPUT_FORMAT\",\n\t\t\t\t\t\"type\": \"dropdown\",\n\t\t\t\t\t\"label\": \"Report Output Format\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"xlsx\",\n\t\t\t\t\t\t\t\"label\": \"Excel (XLSX)\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"csv\",\n\t\t\t\t\t\t\t\"label\": \"CSV\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"html\",\n\t\t\t\t\t\t\t\"label\": \"HTML\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"LAUNCHER_CONTEXT_ID\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"SAS Launcher Context ID\",\n\t\t\t\t\t\"placeholder\": \"ex. b7be2e5f-a65a-4659-8e4e-84d833b2bcc5\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"REPORT_INCLUDE_HEADER\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Include Report Header?\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"True\",\n\t\t\t\t\t\t\t\"label\": \"Yes\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"False\",\n\t\t\t\t\t\t\t\"label\": \"No\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"REPORT_FILTERS\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Report Filters\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"REPORT_BATCH_SK_LIST\",\n\t\t\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\t\t\"label\": \"Batch SK Filter (Provide as a comma-separated list)\",\n\t\t\t\t\t\t\t\"placeholder\": \"ex. 1, 2, 3\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"indent\": 0\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"REPORT_BATCH_TAG_LIST\",\n\t\t\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\t\t\"label\": \"Batch Tag Filter (Provide as comma-separated list)\",\n\t\t\t\t\t\t\t\"placeholder\": \"ex. Batch_123, Batch_ABC\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"indent\": 0\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"REPORT_MIN_DT\",\n\t\t\t\t\t\t\t\"type\": \"datetime\",\n\t\t\t\t\t\t\t\"label\": \"Earliest Execution Date\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"indent\": 0\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"REPORT_MAX_DT\",\n\t\t\t\t\t\t\t\"type\": \"datetime\",\n\t\t\t\t\t\t\t\"label\": \"Latest Execution Date\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"indent\": 0\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"COMMAND\": null,\n\t\t\"REPORT_OUTPUT_FORMAT\": {\n\t\t\t\"value\": \"xlsx\",\n\t\t\t\"label\": \"Excel (XLSX)\"\n\t\t},\n\t\t\"LAUNCHER_CONTEXT_ID\": \"\",\n\t\t\"REPORT_INCLUDE_HEADER\": {\n\t\t\t\"value\": \"False\",\n\t\t\t\"label\": \"No\"\n\t\t},\n\t\t\"REPORT_BATCH_SK_LIST\": null,\n\t\t\"REPORT_BATCH_TAG_LIST\": \"\",\n\t\t\"REPORT_MIN_DT\": null,\n\t\t\"REPORT_MAX_DT\": null\n\t}\n}","templates":{"SAS":"/*Clean up whitespace around delimited list entries*/\n%let REPORT_BATCH_TAG_LIST = %sysfunc(compbl(%quote(&REPORT_BATCH_TAG_LIST.)));\n%let REPORT_BATCH_TAG_LIST = %sysfunc(tranwrd(%quote(&REPORT_BATCH_TAG_LIST.), %str(, ), %str(,)));\n%let REPORT_BATCH_TAG_LIST = %sysfunc(tranwrd(%quote(&REPORT_BATCH_TAG_LIST.), %str( ,), %str(,)));\n\n%let REPORT_BATCH_SK_LIST = %sysfunc(compbl(%quote(&REPORT_BATCH_SK_LIST.)));\n%let REPORT_BATCH_SK_LIST = %sysfunc(tranwrd(%quote(&REPORT_BATCH_SK_LIST.), %str(, ), %str(,)));\n%let REPORT_BATCH_SK_LIST = %sysfunc(tranwrd(%quote(&REPORT_BATCH_SK_LIST.), %str( ,), %str(,)));\n\n/* Create a temporary file */\nfilename outResp temp; \n\n/* Get the Viya Host URL */\n%let viyaHost=%sysfunc(getoption(SERVICESBASEURL));\n\n%let HTTP_REQUEST_BODY=%str({ \"name\":\"sda-batch-ocr-process\",\n          \"description\":\"Execute Report Generation Process Using SAS Document Analysis\",\n           \"command\":\"python process/sda-ocr/scripts/%superq(COMMAND)\",\n           \"contextId\":\"%superq(LAUNCHER_CONTEXT_ID)\",\n           \"environment\":{\n                \"REPORT_OUTPUT_FORMAT\":\"%superq(REPORT_OUTPUT_FORMAT)\",\n                \"REPORT_INCLUDE_HEADER\":\"%superq(REPORT_INCLUDE_HEADER)\",\n                \"REPORT_BATCH_SK_LIST\":\"%superq(REPORT_BATCH_SK_LIST)\",\n                \"REPORT_BATCH_TAG_LIST\":\"%superq(REPORT_BATCH_TAG_LIST)\",\n                \"REPORT_MIN_DT\":\"%superq(REPORT_MIN_DT)\",\n                \"REPORT_MAX_DT\":\"%superq(REPORT_MAX_DT)\"\n            }, \n           \"kubernetes\": {\"jobNamePrefix\": \"sda-execute-report-\"} \n     });\n\n/* Proc HTTP Request */\nproc http method='POST' \n    url=\"&viyaHost./launcher/processes\" \n    in=%tslit(&HTTP_REQUEST_BODY)\n    oauth_bearer=sas_services out=outResp; \n    debug level=1; \n    headers 'Accept'=' application/vnd.sas.launcher.process+json'; \n    headers 'Content-Type'=' application/json';\nrun;\n\n/* HTTP Status Handling */\ndata _null_; \n    if &SYS_PROCHTTP_STATUS_CODE. lt 400 then do; \n        put \"NOTE: The request to launch the SDA process was successful.\"; \n        put \"NOTE: The HTTP Status Code is &SYS_PROCHTTP_STATUS_CODE..\"; \n        put \"NOTE: That means: &SYS_PROCHTTP_STATUS_PHRASE..\"; \n    end; \n    else do; \n        put \"ERROR: The request to launch the SDA process was most likely not successful.\"; \n        put \"ERROR: The HTTP Status Code is &SYS_PROCHTTP_STATUS_CODE..\"; \n        put \"ERROR: That means: &SYS_PROCHTTP_STATUS_PHRASE..\"; \n    end; \nrun;\n\n/*Response Parsing*/\nlibname resp json fileref=outResp;\n\n%let OUTPUT_DIRECTORY = \"\";\n%let PROCESS = \"\";\ndata _null_;\nset resp.alldata;\nif upcase(P1)=\"ENVIRONMENT\" then do;\n\tif upcase(P2)=\"OUTPUT_DIRECTORY\" then call symput(\"OUTPUT_DIRECTORY\",cats(value));\n\tif upcase(P2)=\"PROCESS\" then call symput(\"PROCESS\",cats(value));\nend;\nrun;\n\ndata message_output;\n    length message $300;\n    if \"&OUTPUT_DIRECTORY.\" ne \"\" and \"&PROCESS.\" ne \"\" then do;\n        message = \"Logs have been routed to \" || \"&OUTPUT_DIRECTORY./&PROCESS./logs\";\n        output;\n        message = \"Output report has been routed to \" || \"&OUTPUT_DIRECTORY./&PROCESS./reports\";\n        output;\n    end;\n\telse do;\n        message = \"Report and logs have been routed to the default location specified during installation\";\n        output;\n\tend;\nrun;\n\nproc print data=message_output noobs;\n    var message;\nrun;\n\nproc sql;\n\tdrop table message_output;\nquit;"}}