{
    "creationTimeStamp": "2025-09-13T14:28:55.179436Z",
    "createdBy": "gerdaw",
    "modifiedTimeStamp": "2025-09-13T15:44:31.774462Z",
    "modifiedBy": "gerdaw",
    "name": "VA - Get Column Explanation.step",
    "displayName": "VA - Get Column Explanation.step",
    "localDisplayName": "VA - Get Column Explanation.step",
    "description": "The \"VA -Get Column Explanation\" custom steps performs an explanation of a column in a CAS table using the /insights/explain endpoint.",
    "links": [
        {
            "method": "GET",
            "rel": "self",
            "href": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "uri": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "type": "application/vnd.sas.data.flow.step"
        },
        {
            "method": "GET",
            "rel": "alternate",
            "href": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "uri": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "type": "application/vnd.sas.data.flow.step.summary"
        },
        {
            "method": "GET",
            "rel": "up",
            "href": "/dataFlows/steps",
            "uri": "/dataFlows/steps",
            "type": "application/vnd.sas.collection",
            "itemType": "application/vnd.sas.data.flow.step.summary"
        },
        {
            "method": "PUT",
            "rel": "update",
            "href": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "uri": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "type": "application/vnd.sas.data.flow.step",
            "responseType": "application/vnd.sas.data.flow.step"
        },
        {
            "method": "DELETE",
            "rel": "delete",
            "href": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "uri": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310"
        },
        {
            "method": "POST",
            "rel": "copy",
            "href": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310/copy",
            "uri": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310/copy",
            "responseType": "application/vnd.sas.data.flow.step"
        },
        {
            "method": "GET",
            "rel": "transferExport",
            "href": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "uri": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "responseType": "application/vnd.sas.transfer.object"
        },
        {
            "method": "PUT",
            "rel": "transferImportUpdate",
            "href": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "uri": "/dataFlows/steps/fbe4a7fa-4b0a-47aa-ab11-11af0e77a310",
            "type": "application/vnd.sas.transfer.object",
            "responseType": "application/vnd.sas.summary"
        }
    ],
    "metadataVersion": 1,
    "version": 2,
    "type": "code",
    "flowMetadata": {
        "inputPorts": [
            {
                "name": "_gce_inputtable",
                "displayName": "_gce_inputtable",
                "localDisplayName": "_gce_inputtable",
                "minEntries": 1,
                "maxEntries": 1,
                "defaultEntries": 0,
                "type": "table"
            }
        ]
    },
    "ui": "{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageOptions\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Options\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_infot_text\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"This step enables you to quickly get insights about a column and how it relates to the other columns in the CAS table.\\n\\nInformation from that screening is printed to the Results tab. In order to see a result you need to check at least one of the boxes below or specify a time series column. Otherwise you will get an empty result tab.\\n\\nBoth global and session scoped CAS tables can be used.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_inputtable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"CAS table for explanation:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"casuser.example\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_target\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"Target variable for the explanation:\",\n\t\t\t\t\t\"include\": null,\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"a\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"table\": \"_gce_inputtable\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_time\",\n\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\"label\": \"The formatted time series column - optional:\",\n\t\t\t\t\t\"include\": null,\n\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\"columntype\": \"n\",\n\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\"min\": 0,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"table\": \"_gce_inputtable\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_ivd\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Include variable description?\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_iod\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Include outlier description?\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_useMissing\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Use missing?\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_gce_ivsr\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Include variable screening results?\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"VA - Get Column Explanation step\\n==========\\n\\nThe \\\"VA - Get Column Explanation\\\" custom steps performs an explanation of a column in a CAS table using the /insights/explain endpoint.\\n\\nThe output of this step is printed to the Results tab.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Pre-requisites:  Tested on Viya version Stable 2025.08\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* https://developer.sas.com/rest-apis/insights/getExplanation\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version: 1.0 (13SEP2025)\\n      - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"_gce_inputtable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"_gce_target\": [],\n\t\t\"_gce_time\": [],\n\t\t\"_gce_ivd\": true,\n\t\t\"_gce_iod\": true,\n\t\t\"_gce_useMissing\": true,\n\t\t\"_gce_ivsr\": true\n\t},\n\t\"columnExclusions\": [\n\t\t[\n\t\t\t\"_gce_time\",\n\t\t\t\"_gce_target\"\n\t\t]\n\t]\n}",
    "templates": {
        "SAS": "/*******************************************************************\n    This step provides an easy integration with the getExplanation\n      endpoint.\n\n    gce - is shorthand for Get Column Explanation\n*******************************************************************/\n\n%if \"&_gce_inputtable_isCas.\" NE \"true\" %then %do; \n    data _null_;\n      putLog 'ERROR: The selected input library does not point to a CASlib';\n      abort;\n   run;\n%end;\n\n%macro _gce_casCheckSessionExists;\n    %local _gce_casSessionExists;\n    %global _gce_casSessionUUID;\n    %* Check whether CAS session exist, and if so retrieve CAS session UUID;\n    %if %sysfunc(symexist(_SESSREF_)) %then %do;\n        %let _gce_casSessionExists= %sysfunc(sessfound(&_SESSREF_));\n        %if &_gce_casSessionExists = 1 %then %do;\n            proc cas;\n                session.sessionId result = sessresults;\n                call symputx(\"_gce_casSessionUUID\", sessresults[1]);\n            quit;\n        %end;\n        %else %do;\n            data _null_;\n                putLog 'ERROR: An active CAS session is required in order to run this step.';\n                abort;\n            run;\n        %end;\n    %end;\n    %else %do;\n        data _null_;\n            putLog 'ERROR: An active CAS session is required in order to run this step.';\n            abort;\n         run;\n    %end;\n%mend _gce_casCheckSessionExists;\n%_gce_casCheckSessionExists;\n\n* Get CAS Server name;\ndata _null_;\n    url = getCASURL();\n    i = find(url, '/', 'i', 10);\n    server = ksubstr(url, i + 1, length(url) -i - 5);\n    call symputx('_gce_server', server);\nrun;\n\nfilename _gce_in '/srv/nfs/kubedata/compute-landingzone/gerdaw/adult/test.json';\n\ndata _null_;\n    file _gce_in;\n    put '{\"cas\": {';\n    server = '\"server\": \"' || \"&_gce_server.\" || '\",';\n    put server;\n    casLibName = getlcaslib(\"casuser\");\n    library  = compress('\"library\": \"' || casLibName || '\",');\n    put library;\n    table = '\"table\": \"' || \"&_gce_inputtable_name.\" || '\",';\n    put table;\n    sessionID = '\"sessionId\": \"' || \"&_gce_casSessionUUID.\" || '\"}';\n    put sessionID;\n    if &_gce_ivd. EQ 0 then do;\n        put ',\"includeVariableDescription\": false';\n    end;\n    if &_gce_iod. EQ 1 then do;\n        put ',\"includeOutlierDescription\": true';\n    end;\n    if &_gce_useMissing. EQ 0 then do;\n        put ',\"useMissing\": false';\n    end;\n    if &_gce_ivsr. EQ 0 then do;\n        put ',\"includeVariableScreeningResults\": false';\n    end;\n    if &_gce_time_count. EQ 1 then do;\n        dateVariable = ',\"dateVariable\": \"' || \"&_gce_time.\" || '\"';\n        put dateVariable;\n    end;\n    target = ',\"targetVariable\": \"' || \"&_gce_target.\" || '\"}';\n    put target;\nrun;\n\n* Get the Viya Host URL;\n%let _gce_viyaHost=%sysfunc(getoption(SERVICESBASEURL)); \nfilename _gce_out temp;\n\n* API call to https://developer.sas.com/rest-apis/insights/getExplanation;\nproc http url = \"&_gce_viyaHost./insights/explain\"\n    method = 'Post'\n    in = _gce_in\n    out = _gce_out\n    oauth_bearer = sas_services;\n    headers 'Accept' = 'application/json'\n        'Content-Type' = 'application/json';\nrun; quit;\n\ndata _null_;\n    if &SYS_PROCHTTP_STATUS_CODE. ne 200 then do;\n        putLog 'ERROR: Request was not successfull';\n        abort;\n    end;\nrun;\n\nlibname _gce_out json;\n\n* Set line size to maximum to reduce warnings about the printed results;\n%let _gce_defaultLineSize = %sysfunc(getoption(linesize));\noptions linesize=256;\ntitle 'Screening result';\nproc print data=_gce_out.root(drop=ordinal_root version) noObs;\nrun; quit;\ntitle;\n\n%if &_gce_ivsr. %then %do;\n    proc sql noPrint;\n        create table work._gce_result_tab as\n            select a.columnName\n                , a.label\n                , b.*\n                from _gce_out.variableScreeningResults as a\n                    left join _gce_out.variableScreening_actionsTaken(keep=ordinal_variableScreeningResults actionsTaken:) as b\n                        on a.ordinal_variableScreeningResults EQ b.ordinal_variableScreeningResults\n    ;quit;\n\n    data work._gce_result_tab;\n        set work._gce_result_tab(where=(actionsTaken1 NE '') drop=ordinal_variableScreeningResults);\n    run;\n\n    title 'Actions performed on columns in the dataset';\n    proc print data=work._gce_result_tab;\n    run; quit;\n    title;\n%end;\n\n* Clean up;\noptions linesize=&_gce_defaultLineSize.;\nfilename _gce_in clear;\nlibname _gce_out clear;\nfilename _gce_out clear;\n%symdel _gce_casSessionUUID _gce_server _gce_viyaHost _gce_defaultLineSize;\n%sysmacdelete _gce_casCheckSessionExists;\nproc datasets lib=work noprint nowarn;\n   delete _gce_result_tab;\nrun; quit;"
    }
}
