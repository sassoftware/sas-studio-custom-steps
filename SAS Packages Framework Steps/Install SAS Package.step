{"creationTimeStamp":"2025-12-12T19:45:13.070975Z","createdBy":"Stu.Sztukowski@sas.com","modifiedTimeStamp":"2026-02-17T22:21:56.793405Z","modifiedBy":"Stu.Sztukowski@sas.com","id":"4ebe0536-c260-4de3-a8cd-5a94d4eaa082","name":"Install SAS Package.step","displayName":"Install SAS Package.step","localDisplayName":"Install SAS Package.step","links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","uri":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","uri":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","uri":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","uri":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082/copy","uri":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","uri":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","uri":"/dataFlows/steps/4ebe0536-c260-4de3-a8cd-5a94d4eaa082","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":1,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","localDisplayName":"inputtable1","minEntries":0,"maxEntries":1,"defaultEntries":0,"type":"table"}],"outputPorts":[{"name":"outputtable1","displayName":"outputtable1","localDisplayName":"outputtable1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageInstall\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Install\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_install_debug\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Debug (Change dependency to view or hide)\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t0\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_package_update\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Update Packages\",\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"indent\": 0\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_repo\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Select a package repository:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"SAS Packages\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"PharmaForest\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"GitHub\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"Custom\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_github_name\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"placeholder\": \"Enter a GitHub username or organization\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$spf_repo\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"GitHub\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_custom_url\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"placeholder\": \"Enter a URL for a package repository\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$spf_repo\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"Custom\"\n\t\t\t\t\t],\n\t\t\t\t\t\"regexp\": \"^(?:(http|ftp)(s)?:\\\\/\\\\/)?[\\\\w.-]+(?:\\\\.[\\\\w\\\\.-]+)+[\\\\w\\\\-\\\\._~:\\\\/?#[\\\\]@!\\\\$&'\\\\(\\\\)\\\\*\\\\+,;=.]+\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_package_list_type\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Choose how to supply packages:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"List\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"File\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_package_list\",\n\t\t\t\t\t\"type\": \"textarea\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"placeholder\": \"Enter one or more packages\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$spf_package_list_type\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"List\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_package_file_fqp\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$spf_package_list_type\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"File\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Input connector:\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t0\n\t\t\t\t\t],\n\t\t\t\t\t\"filter\": false,\n\t\t\t\t\t\"readonly\": false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outputtable1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output connector:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t0\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Install SAS Package step\\n====================\\n\\nThe Install SAS Package step installs one or more SAS packages from a repository to a mounted network location or SAS Content. It is an independent step that acts as an interface to the %installPackage macro from the SAS Packages Framework. This step supports workflows such as installing SAS packages from multiple sources or fine-grained control over a flow.\\n\\nFor more information on the %installPackage macro, see:\\nhttps://github.com/yabwon/SAS_PACKAGES/blob/main/SPF/SPFinit.md#installPackage\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"• SAS Packages Framework >= 20251231\\n\\n• The SAS Packages Framework must be initialized before running this step. This step is supported if the SAS Packages Framework is initialized with code.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"SAS packages can be installed from either a list of packages or a text file (packages.txt). Packages must be space or carriage-return separated, and may include a version. Valid package name formats are:\\n\\npackage\\npackage(version)\\npackage[version]\\npackage{version}\\npackage==version\\n\\nIf a package already exists, it will be overwritten if the \\\"Update packages\\\" option is selected.\\n\\nPackages can be installed from one of four sources:\\n\\n1. SAS Packages Archive: https://github.com/SASPAC/\\n2. PharmaForest: https://github.com/PharmaForest/\\n3. GitHub: https://github.com/<github>/<packagename>/raw/...\\n4. Custom: Any website that hosts SAS packages\\n\\nYou can only choose one source at a time. All packages to be installed must come from the same source.\\n\\nℹ️ Packages installed to SAS Content are first installed to the WORK directory, then copied to SAS Content with %relocatePackage.\\n\\nIf \\\"Update packages\\\" is enabled and the package checksums differ between the newly downloaded package and the one in SAS Content, then the package is copied. If \\\"Update packages\\\" is disabled or the checksums match, then the package is not copied.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version 1.0.0 (17FEB2026)\\n    - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"spf_install_debug\": false,\n\t\t\"spf_package_update\": true,\n\t\t\"spf_repo\": {\n\t\t\t\"value\": \"SAS Packages\"\n\t\t},\n\t\t\"spf_github_name\": \"\",\n\t\t\"spf_custom_url\": \"\",\n\t\t\"spf_package_list_type\": {\n\t\t\t\"value\": \"List\"\n\t\t},\n\t\t\"spf_package_list\": \"\",\n\t\t\"spf_package_file_fqp\": \"\",\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"outputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t},\n\t\"promptHierarchies\": []\n}","localUi":"{\"pages\":[{\"children\":[{\"id\":\"spf_install_debug\",\"label\":\"Debug (Change dependency to view or hide)\",\"type\":\"checkbox\",\"visible\":[1,\"=\",0]},{\"id\":\"spf_package_update\",\"indent\":0,\"label\":\"Update Packages\",\"type\":\"checkbox\",\"visible\":\"\"},{\"id\":\"spf_repo\",\"items\":[{\"value\":\"SAS Packages\"},{\"value\":\"PharmaForest\"},{\"value\":\"GitHub\"},{\"value\":\"Custom\"}],\"label\":\"Select a package repository:\",\"type\":\"radiogroup\",\"visible\":\"\"},{\"id\":\"spf_github_name\",\"label\":\"\",\"placeholder\":\"Enter a GitHub username or organization\",\"required\":true,\"type\":\"textfield\",\"visible\":[\"$spf_repo\",\"=\",\"GitHub\"]},{\"id\":\"spf_custom_url\",\"label\":\"\",\"placeholder\":\"Enter a URL for a package repository\",\"regexp\":\"^(?:(http|ftp)(s)?:\\\\/\\\\/)?[\\\\w.-]+(?:\\\\.[\\\\w\\\\.-]+)+[\\\\w\\\\-\\\\._~:\\\\/?#[\\\\]@!\\\\$\\u0026'\\\\(\\\\)\\\\*\\\\+,;=.]+\",\"required\":true,\"type\":\"textfield\",\"visible\":[\"$spf_repo\",\"=\",\"Custom\"]},{\"id\":\"spf_package_list_type\",\"items\":[{\"value\":\"List\"},{\"value\":\"File\"}],\"label\":\"Choose how to supply packages:\",\"type\":\"radiogroup\",\"visible\":\"\"},{\"id\":\"spf_package_list\",\"label\":\"\",\"placeholder\":\"Enter one or more packages\",\"required\":true,\"type\":\"textarea\",\"visible\":[\"$spf_package_list_type\",\"=\",\"List\"]},{\"id\":\"spf_package_file_fqp\",\"label\":\"\",\"pathtype\":\"file\",\"placeholder\":\"\",\"required\":true,\"type\":\"path\",\"visible\":[\"$spf_package_list_type\",\"=\",\"File\"]},{\"filter\":false,\"id\":\"inputtable1\",\"label\":\"Input connector:\",\"placeholder\":\"\",\"readonly\":false,\"required\":false,\"type\":\"inputtable\",\"visible\":[1,\"=\",0]},{\"id\":\"outputtable1\",\"label\":\"Output connector:\",\"placeholder\":\"\",\"required\":true,\"type\":\"outputtable\",\"visible\":[1,\"=\",0]}],\"id\":\"pageInstall\",\"label\":\"Install\",\"type\":\"page\"},{\"children\":[{\"id\":\"textAbout\",\"text\":\"Install SAS Package step\\n====================\\n\\nThe Install SAS Package step installs one or more SAS packages from a repository to a mounted network location or SAS Content. It is an independent step that acts as an interface to the %installPackage macro from the SAS Packages Framework. This step supports workflows such as installing SAS packages from multiple sources or fine-grained control over a flow.\\n\\nFor more information on the %installPackage macro, see:\\nhttps://github.com/yabwon/SAS_PACKAGES/blob/main/SPF/SPFinit.md#installPackage\",\"type\":\"text\",\"visible\":\"\"},{\"children\":[{\"id\":\"textPrereqs\",\"text\":\"• SAS Packages Framework \\u003e= 20251231\\n\\n• The SAS Packages Framework must be initialized before running this step. This step is supported if the SAS Packages Framework is initialized with code.\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionPrereqs\",\"label\":\"Pre-requisites\",\"open\":false,\"type\":\"section\",\"visible\":\"\"},{\"children\":[{\"id\":\"textDocumentation\",\"text\":\"SAS packages can be installed from either a list of packages or a text file (packages.txt). Packages must be space or carriage-return separated, and may include a version. Valid package name formats are:\\n\\npackage\\npackage(version)\\npackage[version]\\npackage{version}\\npackage==version\\n\\nIf a package already exists, it will be overwritten if the \\\"Update packages\\\" option is selected.\\n\\nPackages can be installed from one of four sources:\\n\\n1. SAS Packages Archive: https://github.com/SASPAC/\\n2. PharmaForest: https://github.com/PharmaForest/\\n3. GitHub: https://github.com/\\u003cgithub\\u003e/\\u003cpackagename\\u003e/raw/...\\n4. Custom: Any website that hosts SAS packages\\n\\nYou can only choose one source at a time. All packages to be installed must come from the same source.\\n\\nℹ️ Packages installed to SAS Content are first installed to the WORK directory, then copied to SAS Content with %relocatePackage.\\n\\nIf \\\"Update packages\\\" is enabled and the package checksums differ between the newly downloaded package and the one in SAS Content, then the package is copied. If \\\"Update packages\\\" is disabled or the checksums match, then the package is not copied.\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionDocumentation\",\"label\":\"Documentation\",\"open\":false,\"type\":\"section\",\"visible\":\"\"},{\"children\":[{\"id\":\"textChangelog\",\"text\":\"* Version 1.0.0 (17FEB2026)\\n    - Initial version\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionChangelog\",\"label\":\"Changelog\",\"open\":true,\"type\":\"section\",\"visible\":\"\"}],\"id\":\"pageAbout\",\"label\":\"About\",\"type\":\"page\"}],\"promptHierarchies\":[],\"showPageContentOnly\":true,\"syntaxversion\":\"1.3.0\",\"values\":{\"inputtable1\":{\"library\":\"\",\"table\":\"\"},\"outputtable1\":{\"library\":\"\",\"table\":\"\"},\"spf_custom_url\":\"\",\"spf_github_name\":\"\",\"spf_install_debug\":false,\"spf_package_file_fqp\":\"\",\"spf_package_list\":\"\",\"spf_package_list_type\":{\"value\":\"List\"},\"spf_package_update\":true,\"spf_repo\":{\"value\":\"SAS Packages\"}}}","templates":{"SAS":"%if &spf_install_debug %then %do;\r\n    %let spf_install_orig_symbolgen = %sysfunc(getoption(symbolgen));\r\n    %let spf_install_orig_mlogic = %sysfunc(getoption(mlogic));\r\n    %let spf_install_orig_mprint = %sysfunc(getoption(mprint));\r\n    %let spf_install_orig_mlogicnest = %sysfunc(getoption(mlogicnest));\r\n    %let spf_install_orig_mprintnest = %sysfunc(getoption(mprintnest));\r\n    options symbolgen mlogic mprint mlogicnest mprintnest;\r\n%end;\r\n\r\n%macro spf_install_step;\r\n    %local spf_repo_arg\r\n           spf_install_args\r\n           spf_package_file_sascontent\r\n           spf_package_file\r\n           spf_package_file_path\r\n           spf_package_file_fileref\r\n           s\r\n    ;\r\n\r\n    /* Remove case-sensitivity */\r\n    %let spf_package_list_type = %upcase(&spf_package_list_type);\r\n\r\n    /******* Error checking *******/\r\n    %if NOT %sysmacexist(installPackage) %then %do;\r\n        %put ERROR: You must initialize the SAS Packages Framework before running the Install Package step.;\r\n        %abort cancel;\r\n    %end;\r\n\r\n    /* Must include a list of packages or a file if installing/loading */\r\n    %if (&spf_package_list_type = LIST AND %bquote(&spf_package_list) =) OR\r\n        (&spf_package_list_type = FILE AND %bquote(&spf_package_file_fqp)=)\r\n    %then %do;\r\n        %put ERROR: You must include a list or file of packages to install.;\r\n        %abort;\r\n    %end;\r\n\r\n    /* GitHub but no text added */\r\n    %if &spf_repo = GITHUB AND %bquote(&spf_github_name) = %then %do;\r\n        %put ERROR: You must include a GitHub username when the GitHub repo option is selected.;\r\n        %abort;\r\n    %end;\r\n\r\n    /* Custom but no text added (Note: installPackage will already check if the URL is valid) */\r\n    %else %if &spf_repo = CUSTOM AND %bquote(&spf_custom_url) = %then %do;\r\n        %put ERROR: You must include a URL when the Custom repo option is selected.;\r\n        %abort;\r\n    %end;\r\n\r\n    %if &spf_package_list_type = FILE %then %do;\r\n        \r\n        /* Get filename and path:\r\n            - packages.txt\r\n            - /location/to/file \r\n        */\r\n        %let spf_package_file_sascontent = %sysevalf(%qscan(%qupcase(&spf_package_file_fqp), 1, /) = SASCONTENT:, boolean);\r\n        %let spf_package_file_fqp        = %qsubstr(&spf_package_file_fqp, %index(&spf_package_file_fqp, /));\r\n        %let spf_package_file            = %qscan(&spf_package_file_fqp, -1, /);\r\n        %let spf_package_file_path       = %qsubstr(&spf_package_file_fqp, 1, %eval(%length(&spf_package_file_fqp)-%length(&spf_package_file)-1));\r\n        %let spf_package_file_fileref    = pkg_%upcase(%substr(%sysfunc(tranwrd(%sysfunc(uuidgen()),-,%str())), 1, 4));\r\n\r\n        %if &spf_package_file_sascontent %then %do;\r\n            filename &spf_package_file_fileref filesrvc\r\n                filename=\"&spf_package_file\"\r\n                folderpath=\"&spf_package_file_path\"\r\n            ;\r\n        %end;\r\n            %else %do;\r\n                filename &spf_package_file_fileref \"&spf_package_file_fqp\";\r\n            %end;\r\n    %end;\r\n\r\n    /* Sets valid package names:\r\n        package\r\n        package(version)\r\n        package[version]\r\n        package{version}\r\n        package==version\r\n    */\r\n    %let re_valid_package_name = ^[a-z0-9_]+(?:\\([0-9.]+\\)|\\{[0-9.]+\\}|\\[[0-9.]+\\]|==[0-9.]+)?$;\r\n\r\n    /* Creates a dataset of packages and versions, and creates macro variables for:\r\n          - A space and comma-separated list of packages with normalized versions: package1(version) package2(version) ...\r\n          - A space-separated list of packages without versions: package1 package2 ...\r\n\r\n       Code that runs depends on the method of input.\r\n    */\r\n    data _null_;\r\n        length package_raw \r\n               package \r\n               version      $256 \r\n               package_list $32767\r\n        ;\r\n\r\n        retain invalid_name_msg 0\r\n               package_list\r\n        ;\r\n        \r\n        /* Either loop through all the values in the manual list, or read from a file */\r\n        %if &spf_package_list_type = LIST %then %do;\r\n\r\n        do i = 1 to countw(\"&spf_package_list\", ,'S');\r\n            package_raw = strip(scan(\"&spf_package_list\", i, ,'S'));\r\n\r\n        %end;\r\n\r\n        /* Or read from a file */\r\n        %else %do;\r\n\r\n        infile &spf_package_file_fileref end=eof;        \r\n        input package_raw$;\r\n        package_raw = strip(package_raw);\r\n\r\n        %end;\r\n\r\n        /* Detect invalid patterns and ignore */\r\n        invalid_name = ( NOT prxmatch(\"/&re_valid_package_name/i\", strip(package_raw)) );\r\n\r\n        if invalid_name then do;\r\n            put 'WARNING: ' package_raw 'is an invalid package name format and will be ignored.';\r\n            invalid_name_msg = 1;\r\n        end;\r\n\r\n        else do;\r\n            \r\n            ver_delim = findc(package_raw, '([{=');\r\n            package   = substr(package_raw, 1, ifn(ver_delim > 0, ver_delim-1, length(package_raw)) );\r\n            version   = compress(substr(package_raw, ver_delim+1), '.' ,'KD');\r\n\r\n            /* package1 package2(version) package3 ... */\r\n            package_list = catx(\r\n                ' ', \r\n                package_list, \r\n                ifc(\r\n                    missing(version), \r\n                    package, \r\n                    cats(package, '(', version, ')') \r\n                ) \r\n            );\r\n\r\n        end;\r\n\r\n        if NOT invalid_name then output;\r\n\r\n        /* End the do loop if reading from a list */\r\n        %if &spf_package_list_type = LIST %then %do;\r\n        \r\n        end;\r\n\r\n        %end;\r\n\r\n        /* Output the list at the end. EOF if reading from file, end of loop if not */ \r\n        %if &spf_package_list_type = FILE %then %do;\r\n\r\n        if eof then do;\r\n\r\n        %end;\r\n\r\n            /* Create valid formats for installPackage and loadPackages:\r\n                - Space-separated list\r\n                - Comma-separated list\r\n                - Comma-separated list that removes versions: \r\n                    package1(6.7.0) package2(6.9.0) package3(4.2.0) --> package1 package2 package3\r\n            */\r\n            call symputx('spf_package_list_clean',     package_list, 'L');\r\n            call symputx('spf_package_list_clean_cs',  tranwrd(package_list, ' ', ','));\r\n            call symputx('spf_package_list_nover',     prxchange(\"s/\\([^)]*\\)//\", -1, package_list), 'L');\r\n            call symputx('n_packages', countw(package_list, ' '), 'L');\r\n            \r\n            if invalid_name_msg  then put 'WARNING: Expected package name formats: ' /\r\n                'package' /\r\n                'package(version)' /\r\n                'package[version]' /\r\n                'package{version}' /\r\n                'package==version' /\r\n            ;\r\n\r\n        %if &spf_package_list_type = FILE %then %do;\r\n\r\n        end;\r\n            \r\n        %end;\r\n\r\n        keep package version;\r\n    run;\r\n\r\n    %let spf_repo = %upcase(&spf_repo);\r\n    \r\n    /* Set installPackage options depending on the repo selected */\r\n    %if &spf_repo = PHARMAFOREST %then\r\n        %let spf_repo_arg = mirror=3\r\n    ;\r\n\r\n    %else %if &spf_repo = GITHUB %then\r\n        %let spf_repo_arg = github=&spf_github_name\r\n    ;\r\n\r\n    %else %if &spf_repo = CUSTOM %then %do;\r\n\r\n        /* Add an ending / if the user forgot - requirement for this option */\r\n        %if %qsubstr(&spf_custom_url, %length(&spf_custom_url), 1) NE %str(/) %then\r\n            %let spf_custom_url = %superq(spf_custom_url)/\r\n        ;\r\n\r\n        %let spf_repo_arg = sourcePath=%superq(spf_custom_url);\r\n    %end;\r\n\r\n    %else %let spf_repo_arg=;\r\n\r\n    %let spf_install_args = replace=&spf_package_update;\r\n\r\n    /* Add future arguments here */\r\n    %if %length(&spf_repo_arg) > 0 %then \r\n        %let spf_install_args = &spf_install_args, &spf_repo_arg\r\n    ;\r\n\r\n    /* Install packages. Must be a space-separated list. */\r\n    %installPackage(&spf_package_list_clean, &spf_install_args);\r\n\r\n    /* Copy from WORK to SAS Content if SAS Content was specified */\r\n    %if %symexist(spf_package_path_is_sascontent) %then %do;\r\n        %if &spf_package_path_is_sascontent %then %do;\r\n\r\n            %put NOTE: Copying packages from WORK to sascontent:&spf_package_path_sascontent;\r\n                \r\n            %relocatePackage(\r\n                &spf_package_list_nover, \r\n                target=&spf_package_path_sascontent, \r\n                tDevice=FILESRVC,\r\n                ignorePackagesFilerefCheck=1,\r\n                checksum=%sysevalf(NOT &spf_package_update, boolean) /* Do not check hashes if spf_package_update is true */\r\n            );\r\n        %end;\r\n    %end;\r\n\r\n%mend spf_install_step;\r\n\r\n%spf_install_step;\r\n\r\n%if &spf_install_debug %then %do;\r\n    options &spf_install_orig_symbolgen \r\n            &spf_install_orig_mlogic \r\n            &spf_install_orig_mlogicnest \r\n            &spf_install_orig_mprint \r\n            &spf_install_orig_mprintnest\r\n    ;\r\n%end;\r\n\r\n%sysmacdelete spf_install_step / NOWARN;"}}
