{"creationTimeStamp":"2025-12-12T19:59:41.561598Z","createdBy":"Stu.Sztukowski@sas.com","modifiedTimeStamp":"2026-02-18T02:45:17.901949Z","modifiedBy":"Stu.Sztukowski@sas.com","id":"0b059114-92bb-48d0-a26c-7a6c82524b72","name":"Unload SAS Package.step","displayName":"Unload SAS Package.step","localDisplayName":"Unload SAS Package.step","links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","uri":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","uri":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","uri":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","uri":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72/copy","uri":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","uri":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","uri":"/dataFlows/steps/0b059114-92bb-48d0-a26c-7a6c82524b72","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":1,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable1","displayName":"inputtable1","localDisplayName":"inputtable1","minEntries":0,"maxEntries":1,"defaultEntries":0,"type":"table"}],"outputPorts":[{"name":"outputtable1","displayName":"outputtable1","localDisplayName":"outputtable1","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table"}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"unload\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Unload\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_unload_debug\",\n\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\"label\": \"Debug (Change dependency to view or hide)\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t0\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_package_list_type\",\n\t\t\t\t\t\"type\": \"radiogroup\",\n\t\t\t\t\t\"label\": \"Choose how to provide packages:\",\n\t\t\t\t\t\"items\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"List\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"value\": \"File\"\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_package_list\",\n\t\t\t\t\t\"type\": \"textarea\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"placeholder\": \"Enter one or more packages\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$spf_package_list_type\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"List\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"spf_package_file_fqp\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"\",\n\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$spf_package_list_type\",\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\"File\"\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable1\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Input connector:\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t0\n\t\t\t\t\t],\n\t\t\t\t\t\"filter\": false,\n\t\t\t\t\t\"readonly\": false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"outputtable1\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output connector:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t0\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"help\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Unload SAS Package step\\n=====================\\n\\nThe Unload SAS Package step unloads one or more SAS packages from the current SAS session. It acts as an interface to the %unloadPackage macro from the SAS Packages Framework. \\n\\nFor more information on the %unloadPackage macro, see:\\nhttps://github.com/yabwon/SAS_PACKAGES/blob/main/SPF/SPFinit.md#unloadPackage\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"• SAS Packages Framework >= 20251231\\n\\n• The SAS Packages Framework must be initialized before running this step. This step is supported if the SAS Packages Framework is initialized with code.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"SAS packages can be unloaded from either a list of packages or a text file. Packages must be space or carriage-return separated. Versions do not have an effect when unloading and are automatically ignored.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version 1.0.0 (17FEB2026)\\n    - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"spf_unload_debug\": false,\n\t\t\"spf_package_list_type\": {\n\t\t\t\"value\": \"List\"\n\t\t},\n\t\t\"spf_package_list\": \"\",\n\t\t\"spf_package_file_fqp\": \"\",\n\t\t\"inputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"outputtable1\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t},\n\t\"promptHierarchies\": []\n}","localUi":"{\"pages\":[{\"children\":[{\"id\":\"spf_unload_debug\",\"label\":\"Debug (Change dependency to view or hide)\",\"type\":\"checkbox\",\"visible\":[1,\"=\",0]},{\"id\":\"spf_package_list_type\",\"items\":[{\"value\":\"List\"},{\"value\":\"File\"}],\"label\":\"Choose how to provide packages:\",\"type\":\"radiogroup\",\"visible\":\"\"},{\"id\":\"spf_package_list\",\"label\":\"\",\"placeholder\":\"Enter one or more packages\",\"required\":true,\"type\":\"textarea\",\"visible\":[\"$spf_package_list_type\",\"=\",\"List\"]},{\"id\":\"spf_package_file_fqp\",\"label\":\"\",\"pathtype\":\"file\",\"placeholder\":\"\",\"required\":true,\"type\":\"path\",\"visible\":[\"$spf_package_list_type\",\"=\",\"File\"]},{\"filter\":false,\"id\":\"inputtable1\",\"label\":\"Input connector:\",\"placeholder\":\"\",\"readonly\":false,\"required\":false,\"type\":\"inputtable\",\"visible\":[1,\"=\",0]},{\"id\":\"outputtable1\",\"label\":\"Output connector:\",\"placeholder\":\"\",\"required\":true,\"type\":\"outputtable\",\"visible\":[1,\"=\",0]}],\"id\":\"unload\",\"label\":\"Unload\",\"type\":\"page\"},{\"children\":[{\"id\":\"textAbout\",\"text\":\"Unload SAS Package step\\n=====================\\n\\nThe Unload SAS Package step unloads one or more SAS packages from the current SAS session. It acts as an interface to the %unloadPackage macro from the SAS Packages Framework. \\n\\nFor more information on the %unloadPackage macro, see:\\nhttps://github.com/yabwon/SAS_PACKAGES/blob/main/SPF/SPFinit.md#unloadPackage\",\"type\":\"text\",\"visible\":\"\"},{\"children\":[{\"id\":\"textPrereqs\",\"text\":\"• SAS Packages Framework \\u003e= 20251231\\n\\n• The SAS Packages Framework must be initialized before running this step. This step is supported if the SAS Packages Framework is initialized with code.\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionPrereqs\",\"label\":\"Pre-requisites\",\"open\":false,\"type\":\"section\",\"visible\":\"\"},{\"children\":[{\"id\":\"textDocumentation\",\"text\":\"SAS packages can be unloaded from either a list of packages or a text file. Packages must be space or carriage-return separated. Versions do not have an effect when unloading and are automatically ignored.\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionDocumentation\",\"label\":\"Documentation\",\"open\":false,\"type\":\"section\",\"visible\":\"\"},{\"children\":[{\"id\":\"textChangelog\",\"text\":\"* Version 1.0.0 (17FEB2026)\\n    - Initial version\",\"type\":\"text\",\"visible\":\"\"}],\"id\":\"sectionChangelog\",\"label\":\"Changelog\",\"open\":true,\"type\":\"section\",\"visible\":\"\"}],\"id\":\"help\",\"label\":\"About\",\"type\":\"page\"}],\"promptHierarchies\":[],\"showPageContentOnly\":true,\"syntaxversion\":\"1.3.0\",\"values\":{\"inputtable1\":{\"library\":\"\",\"table\":\"\"},\"outputtable1\":{\"library\":\"\",\"table\":\"\"},\"spf_package_file_fqp\":\"\",\"spf_package_list\":\"\",\"spf_package_list_type\":{\"value\":\"List\"},\"spf_unload_debug\":false}}","templates":{"SAS":"%if &spf_unload_debug %then %do;\r\n    %let spf_unload_orig_symbolgen  = %sysfunc(getoption(symbolgen));\r\n    %let spf_unload_orig_mlogic     = %sysfunc(getoption(mlogic));\r\n    %let spf_unload_orig_mprint     = %sysfunc(getoption(mprint));\r\n    %let spf_unload_orig_mlogicnext = %sysfunc(getoption(mlogicnest));\r\n    %let spf_unload_orig_mprintnest = %sysfunc(getoption(mprintnest));\r\n    options symbolgen mlogic mprint mlogicnest mprintnest;\r\n%end;\r\n\r\n%macro spf_unload_step;\r\n    %local spf_package\r\n           spf_package_file_sascontent\r\n           spf_package_file\r\n           spf_package_file_path\r\n           spf_package_file_fileref\r\n           i\r\n           s\r\n    ;\r\n\r\n    %if NOT %sysmacexist(unloadPackage) %then %do;\r\n        %put ERROR: You must initialize the SAS Packages Framework before running the Unload Package step.;\r\n        %abort cancel;\r\n    %end;\r\n\r\n    /* Remove case-sensitivity */\r\n    %let spf_package_list_type = %upcase(&spf_package_list_type);\r\n    \r\n    /* Must include a list of packages or a file if installing/loading */\r\n    %if (&spf_package_list_type = LIST AND %bquote(&spf_package_list) =) OR\r\n        (&spf_package_list_type = FILE AND %bquote(&spf_package_file_fqp)=)\r\n    %then %do;\r\n        %put ERROR: You must include a list or file of packages to unload.;\r\n        %abort;\r\n    %end;\r\n\r\n    %if &spf_package_list_type = FILE %then %do;\r\n        \r\n        /* Get filename and path:\r\n            - packages.txt\r\n            - /location/to/file \r\n        */\r\n        %let spf_package_file_sascontent = %sysevalf(%qscan(%qupcase(&spf_package_file_fqp), 1, /) = SASCONTENT:, boolean);\r\n        %let spf_package_file_fqp        = %qsubstr(&spf_package_file_fqp, %index(&spf_package_file_fqp, /));\r\n        %let spf_package_file            = %qscan(&spf_package_file_fqp, -1, /);\r\n        %let spf_package_file_path       = %qsubstr(&spf_package_file_fqp, 1, %eval(%length(&spf_package_file_fqp)-%length(&spf_package_file)-1));\r\n        %let spf_package_file_fileref    = pkg_%upcase(%substr(%sysfunc(tranwrd(%sysfunc(uuidgen()),-,%str())), 1, 4));\r\n\r\n        %if &spf_package_file_sascontent %then %do;\r\n            filename &spf_package_file_fileref filesrvc\r\n                filename=%sysfunc(quote(&spf_package_file))\r\n                folderpath=%sysfunc(quote(&spf_package_file_path))\r\n            ;\r\n        %end;\r\n            %else %do;\r\n                filename &spf_package_file_fileref %sysfunc(quote(&spf_package_file_fqp));\r\n            %end;\r\n    %end;\r\n\r\n    /* Creates a dataset of packages and versions, and creates macro variables for:\r\n           - A space and comma-separated list of packages with normalized versions: package1(version) package2(version) ...\r\n           - A space-separated list of packages without versions: package1 package2 ...\r\n\r\n       Code that runs depends on the method of input.\r\n    */\r\n    data _null_;\r\n       length package_raw \r\n              package \r\n              package_list_nover $32767\r\n       ;\r\n\r\n       retain package_list_nover;\r\n                \r\n       /* Either loop through all the values in the manual list, or read from a file */\r\n       %if &spf_package_list_type = LIST %then %do;\r\n\r\n       do i = 1 to countw(\"&spf_package_list\", ,'S');\r\n           package_raw = strip(scan(\"&spf_package_list\", i, ,'S'));\r\n\r\n       %end;\r\n\r\n       /* Or read from a file */\r\n       %else %do;\r\n\r\n       infile &spf_package_file_fileref end=eof;        \r\n       input package_raw$;\r\n       package_raw = strip(package_raw);\r\n\r\n       %end;\r\n\r\n       ver_delim = findc(package_raw, '([{=');\r\n       package   = substr(package_raw, 1, ifn(ver_delim > 0, ver_delim-1, length(package_raw)) );\r\n\r\n       /* package1 package2 package3 ... */\r\n       package_list_nover    = catx(' ', package_list_nover, package);\r\n\r\n       /* End the do loop if reading from a list */\r\n       %if &spf_package_list_type = LIST %then %do;\r\n                \r\n       end;\r\n\r\n       %end;\r\n\r\n       /* Output the list at the end. EOF if reading from file, end of loop if not */ \r\n       %if &spf_package_list_type = FILE %then %do;\r\n\r\n       if eof then do;\r\n\r\n       %end;\r\n\r\n       /* Create valid formats for unloadPackage:\r\n              - package1(6.7.0) package2(6.9.0) package3(4.2.0) --> package1 package2 package3\r\n       */\r\n           call symputx('spf_package_list_nover', package_list_nover, 'L');\r\n           call symputx('n_packages', countw(package_list_nover, ' '), 'L');\r\n        %if &spf_package_list_type = FILE %then %do;\r\n\r\n        end;\r\n                    \r\n        %end;\r\n\r\n        keep package version;\r\n    run;\r\n\r\n    %if &n_packages < 1 %then %do;\r\n        %put ERROR: You must specify at least one package to unload.;\r\n        %abort;\r\n    %end;\r\n\r\n    %if &n_packages > 1 %then %let s = s;\r\n            %else %let s =;\r\n                        \r\n    %put NOTE: Unloading &n_packages package&s;\r\n\r\n    %do i = 1 %to %sysfunc(countw(&spf_package_list_nover));\r\n        %let spf_package = %scan(&spf_package_list_nover, &i);\r\n        %unloadPackage(&spf_package);\r\n    %end;\r\n    \r\n%mend spf_unload_step;\r\n%spf_unload_step;\r\n\r\n%if &spf_unload_debug %then %do;\r\n    options &spf_unload_orig_symbolgen \r\n            &spf_unload_orig_mlogic \r\n            &spf_unload_orig_mlogicnest \r\n            &spf_unload_orig_mprint \r\n            &spf_unload_orig_mprintnest\r\n    ;\r\n%end;\r\n\r\n%sysmacdelete spf_unload_step / NOWARN;"}}
