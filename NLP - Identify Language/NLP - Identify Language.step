{"creationTimeStamp":"2023-02-20T12:19:52.532Z","modifiedTimeStamp":"2023-02-20T12:22:03.550Z","createdBy":"Sundaresh.Sankaran@sas.com","modifiedBy":"Sundaresh.Sankaran@sas.com","name":"NLP - Identify Language.step","displayName":"NLP - Identify Language.step","localDisplayName":"NLP - Identify Language.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","uri":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","uri":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","uri":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","uri":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","uri":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","uri":"/dataFlows/steps/e0ba85ec-8dbe-4251-aed5-5bc0c0d8bb1e","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[{"name":"inputtable","displayName":"inputtable","localDisplayName":"inputtable","minEntries":1,"maxEntries":1,"type":"table"}],"outputPorts":[{"name":"casout","displayName":"casout","localDisplayName":"casout","minEntries":1,"maxEntries":1,"type":"table","columnDelta":{"keepColumnArguments":["docId","textVar","copyVarColumns"],"updateColumnArguments":["langColumn"]},"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"parameters\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Parameters\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"inputtable\",\n\t\t\t\t\t\"type\": \"inputtable\",\n\t\t\t\t\t\"label\": \"Input table:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section1\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Input parameters\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"docId\",\n\t\t\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\t\t\"label\": \"Select document ID:\",\n\t\t\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\t\t\"columntype\": \"a\",\n\t\t\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"table\": \"inputtable\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textVar\",\n\t\t\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\t\t\"label\": \"Select text variable:\",\n\t\t\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\t\t\"columntype\": \"c\",\n\t\t\t\t\t\t\t\"max\": 1,\n\t\t\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"table\": \"inputtable\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"langColumn\",\n\t\t\t\t\t\t\t\"type\": \"newcolumn\",\n\t\t\t\t\t\t\t\"label\": \"Language column (for informational purposes only):\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"hideproperties\": false,\n\t\t\t\t\t\t\t\"readonly\": true,\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section2\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Output table specifications\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Note: If left blank, only the document ID, text variable, and the generated _language_ column gets copied over to the output table.  \",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"copyVarColumns\",\n\t\t\t\t\t\t\t\"type\": \"columnselector\",\n\t\t\t\t\t\t\t\"label\": \"Select additional columns to copy over:\",\n\t\t\t\t\t\t\t\"order\": false,\n\t\t\t\t\t\t\t\"columntype\": \"a\",\n\t\t\t\t\t\t\t\"max\": null,\n\t\t\t\t\t\t\t\"min\": null,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"table\": \"inputtable\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"casout\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"about\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"NLP - Identify Language\\n\\nThis custom step identifies the language for text data in an input table and creates a new column containing the language's ISO 639-1 code.  It makes use of the textManagement.identifyLanguage CAS action (link provided in documentation below).\\n\\nSome business applications such as social media data, customer reviews and government / law enforcement deal with data in multiple languages. This custom step aids identification and downstream segmentation of observations as per language, so that they can then be analysed using the relevant language pack.\\n\\nParameters:\\n\\nNote that this custom step runs on data loaded in Cloud Analytics Services (CAS). Ensure you are connected to CAS before running this step.\\n\\nInput parameters:\\n\\n1. Input port: connect an input CAS table.\\n\\n2. Document ID: select a column which serves as an ID for each observation.\\n\\n3. Text variable: select a character column which contains the text to be analyzed.\\n\\nOutput table specifications:\\n\\n1. Output columns: select columns which you would like copied over to the output table.\\n\\n2. Output port: connect an output CAS table.\\n\\nThe custom step results in a new column, called _language_ which contains the ISO 639-1 language code.\\n\\nDocumentation:\\n\\n1. textmanagement.identifyLanguage CAS action : https://go.documentation.sas.com/doc/en/pgmsascdc/default/casanpg/n0qdvvymlj69d7n18dfvh6ipjn2k.htm#p0sk06te8li0uyn14l3kt8i4gvdw\\n\\nCreated / contact : \\n\\n- Sundaresh Sankaran (sundaresh.sankaran@sas.com)\\n\\nVersion : 1.0.   (15FEB2023)\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"inputtable\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"docId\": [],\n\t\t\"textVar\": [],\n\t\t\"langColumn\": {\n\t\t\t\"value\": \"_language_\",\n\t\t\t\"label\": \"_language_\"\n\t\t},\n\t\t\"copyVarColumns\": [],\n\t\t\"casout\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t}\n}","templates":{"SAS":"/* SAS templated code goes here */\n\n/* Make use of utility macro to obtain a list of selected variables, separated by spaces */\n%let blankSeparatedList = %_flw_get_column_list(_flw_prefix=copyVarColumns);\n\n/* Create a table of the columns to be copied, which can be merged with the output table. */\ndata work._temp_table_ (keep= &docId. &blankSeparatedList.);\n   set &inputtable.;\nrun;\n\n/* Call the CAS action contained within the Text Management action set (which is available within all Viya offerings) */\nproc cas;\n\n/* Note: Even though the identifyLanguage action already has a copyVars parameter, this is deliberately not being used, due to some known issues with copyVars under investigation */\n\n/* Run the identifyLanguage action */\ntextManagement.identifyLanguage /\n   table = {name=\"&inputtable_name_base.\", caslib=\"&inputtable_lib.\"}\n   text=\"&TEXTVAR_1_NAME_BASE.\"\n   docId = \"&DOCID_1_NAME_BASE.\"\n   casout={name=\"&casout_name_base.\", caslib=\"&casout_lib.\", replace=True}\n;\n\n/* Future placeholder:  Add an option to filter for specific languages */\n\nquit;\n\n/* The following test is to check if additional copyVars columns are blank.  If so, then nothing happens. Otherwise, an additional step is carried out to merge the output data with the set of additional columns. */\n\n%if %sysevalf(%superq(blankSeparatedList)=,boolean)  %then %do;\n   %put \"Blank list provided. No other columns will be copied.\";\n%end;\n%else %do;\n\n   data &casout.;\n      merge &casout.(in=a) work._temp_table_ (in=b);\n      by &docId.;\n      if a;\n   run;\n   \n\n%end;\n\n\n/* Clean up - remove temp table */\nproc datasets lib=work;\n   delete _temp_table_;\nquit;"}}