{"creationTimeStamp":"2024-12-30T17:24:11.953Z","modifiedTimeStamp":"2024-12-31T16:18:28.988Z","createdBy":"charlie.vismara@sas.com","modifiedBy":"charlie.vismara@sas.com","name":"SASAPI - GET Metadata.step","displayName":"SASAPI - GET Metadata.step","localDisplayName":"SASAPI - GET Metadata.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","uri":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","uri":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","uri":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","uri":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79/copy","uri":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","uri":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","uri":"/dataFlows/steps/cacd3f68-2f8a-4522-ac04-885f39ec8d79","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[{"name":"root","displayName":"root","localDisplayName":"root","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","supportsView":false,"requiresStructure":false},{"name":"links","displayName":"links","localDisplayName":"links","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","supportsView":false,"requiresStructure":false},{"name":"items","displayName":"items","localDisplayName":"items","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","supportsView":false,"requiresStructure":false},{"name":"items_links","displayName":"items_links","localDisplayName":"items_links","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","supportsView":false,"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"Request\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"GET Request\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"href\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"GET request : Hyperlink reference destination (HREF)\",\n\t\t\t\t\t\"placeholder\": \"/folders/rootFolders\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"indent\": 0\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"type\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"GET request : Accepted Content Type Header (+json)\",\n\t\t\t\t\t\"placeholder\": \"application/json\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"indent\": 0\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_limit\",\n\t\t\t\t\t\"type\": \"numberfield\",\n\t\t\t\t\t\"label\": \"Limit number of returned items \",\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"integer\": true,\n\t\t\t\t\t\"min\": 1,\n\t\t\t\t\t\"max\": null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Full list of available GET requests and associated HREF & Content-Type can be found in \\nSAS REST API guide :  https://developer.sas.com/rest-apis\",\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"indent\": 0\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"root\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Root\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"links\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"links\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"items\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Items\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"items_links\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Items_links\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"About\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text2\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"> Tested on Viya version Stable 2024.12\\n\\n> Uses : SAS REST API (https://developer.sas.com/rest-apis)\\n\\n> version 1.0\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"href\": \"\",\n\t\t\"type\": \"application/json\",\n\t\t\"_limit\": 100,\n\t\t\"root\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"links\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"items\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"items_links\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t}\n\t}\n}","templates":{"SAS":"/*----------------------------------------------------------------------------------------*\n    This custom step allow the user to call any SAS VIYA API GET requests and returns the response into 3 output datasets : \n\t   - root : root items returned by the request\n\t   - links : root links returned by the request\n\t   - items : collection items returned by the request + items self HREF and TYPE\n\t   - items_links : collection items links returned by the request\n\t\t\n*------------------------------------------------------------------------------------------*/\n\n%macro _get_viya_items ; \n\n   %if %sysfunc(libref(resp)) = 0 %then %do;\n      libname resp clear ; \n   %end ; \n   data &root.; run;\n   data &links.; run;\n   data &items.; run;\n   data &items_links.; run;\n\n/*----------------------------------------------------------------------------------------*\n   Send GET request to local VIYA API \n*----------------------------------------------------------------------------------------*/\n\n   filename resp temp;\n\n   %put NOTE: REQUEST = \"%sysfunc(getoption(SERVICESBASEURL))&href.?limit=&_limit.\" ;\n   %put NOTE: Accepted Content-Type = \"&type\" ;\n\n   proc http\n      url = \"%sysfunc(getoption(SERVICESBASEURL))&href.?limit=&_limit.\"\n      out=resp\n      oauth_bearer = sas_services ;\n      headers\n\t        'Accept'= \"&type\";\n\t  debug level=1 ; \n   run;\n\n   %if &SYS_PROCHTTP_STATUS_CODE. ne 200 %then %do;\n     %put ERROR: HTTP &SYS_PROCHTTP_STATUS_CODE. : &SYS_PROCHTTP_STATUS_PHRASE. ; \n   %end ;\n   %else %do ; \n\n/*----------------------------------------------------------------------------------------*\n   Extract data from response\n*----------------------------------------------------------------------------------------*/\n\n      libname resp JSON ; \n\n     %if %sysfunc(exist(resp.root)) %then %do ;\n        data &root ; set resp.root ; run ; \n     %end ; \n\n     %if %sysfunc(exist(resp.links)) %then %do ;\n        data &links ; set resp.links ; run ;\n     %end ; \n\n      %if %sysfunc(exist(resp.items)) %then %do ;\n         proc sql noprint ; \n          create table &items as\t\n            select \n               i.*, l.href as GET_SELF_HREF, \n               l.type as GET_SELF_TYPE \n            from resp.items i inner join resp.items_links l \n\t      on i.ordinal_items = l.ordinal_items\n\t      where l.method = 'GET' and l.rel = 'self' ; \n         run ; \n         quit ; \n     %end ; \n\n     %if %sysfunc(exist(resp.items_links)) %then %do ;\n        data &items_links ; set resp.items_links ; run ; \n     %end ; \n\n     libname resp clear ; \n\n   %end ; \n\n   filename resp clear ; \n\n%mend _get_viya_items ; \n\n%_get_viya_items ;"}}